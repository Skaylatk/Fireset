// Copyright (c) 2025-2026 Henrique Rodrigues Santos
// Licensed under the MIT License
// Github: https://github.com/saintsHr/Fireset

#include "fireset/ui.h"

#include "fireset/render.h"
#include "fireset/settings.h"

static const uint8_t font8x8[26][8] = {
    {0x18,0x24,0x42,0x7E,0x42,0x42,0x42,0x00}, // FS_CHAR_A
    {0x7C,0x42,0x42,0x7C,0x42,0x42,0x7C,0x00}, // FS_CHAR_B
    {0x3C,0x42,0x40,0x40,0x40,0x42,0x3C,0x00}, // FS_CHAR_C
    {0x78,0x44,0x42,0x42,0x42,0x44,0x78,0x00}, // FS_CHAR_D
    {0x7E,0x40,0x40,0x7C,0x40,0x40,0x7E,0x00}, // FS_CHAR_E
    {0x7E,0x40,0x40,0x7C,0x40,0x40,0x40,0x00}, // FS_CHAR_F
    {0x3C,0x42,0x40,0x4E,0x42,0x42,0x3C,0x00}, // FS_CHAR_G
    {0x42,0x42,0x42,0x7E,0x42,0x42,0x42,0x00}, // FS_CHAR_H
    {0x3E,0x08,0x08,0x08,0x08,0x08,0x3E,0x00}, // FS_CHAR_I
    {0x1E,0x04,0x04,0x04,0x44,0x44,0x38,0x00}, // FS_CHAR_J
    {0x42,0x44,0x48,0x70,0x48,0x44,0x42,0x00}, // FS_CHAR_K
    {0x40,0x40,0x40,0x40,0x40,0x40,0x7E,0x00}, // FS_CHAR_L
    {0x42,0x66,0x5A,0x42,0x42,0x42,0x42,0x00}, // FS_CHAR_M
    {0x42,0x62,0x52,0x4A,0x46,0x42,0x42,0x00}, // FS_CHAR_N
    {0x3C,0x42,0x42,0x42,0x42,0x42,0x3C,0x00}, // FS_CHAR_O
    {0x7C,0x42,0x42,0x7C,0x40,0x40,0x40,0x00}, // FS_CHAR_P
    {0x3C,0x42,0x42,0x42,0x4A,0x44,0x3A,0x00}, // FS_CHAR_Q
    {0x7C,0x42,0x42,0x7C,0x48,0x44,0x42,0x00}, // FS_CHAR_R
    {0x3C,0x42,0x40,0x3C,0x02,0x42,0x3C,0x00}, // FS_CHAR_S
    {0x7F,0x08,0x08,0x08,0x08,0x08,0x08,0x00}, // FS_CHAR_T
    {0x42,0x42,0x42,0x42,0x42,0x42,0x3C,0x00}, // FS_CHAR_U
    {0x42,0x42,0x42,0x42,0x42,0x24,0x18,0x00}, // FS_CHAR_V
    {0x42,0x42,0x42,0x42,0x5A,0x66,0x42,0x00}, // FS_CHAR_W
    {0x42,0x24,0x18,0x18,0x18,0x24,0x42,0x00}, // FS_CHAR_X
    {0x42,0x24,0x18,0x18,0x08,0x08,0x08,0x00}, // FS_CHAR_Y
    {0x7E,0x04,0x08,0x10,0x20,0x40,0x7E,0x00}, // FS_CHAR_Z
};

FsChar fsMapChar(char c){
    if (c >= 'A' && c <= 'Z') return FS_CHAR_A + (c - 'A');
    if (c >= 'a' && c <= 'z') return FS_CHAR_A + (c - 'a');
    return FS_CHAR_UNKNOWN;
}

void fsDrawChar(FsVec2 position, int size, FsColor color, FsChar c){
    const int base = 8;

    for (int row = 0; row < base; row++){
        uint8_t bits = font8x8[c][row];
        for (int col = 0; col < base; col++){
            if (bits & (1 << (7 - col))){
                for (int dy = 0; dy < size; dy++){
                    for (int dx = 0; dx < size; dx++){
                        FsPoint p = FsPoint_new(
                            FsVec2_new(
                                position.x + col*size + dx,
                                position.y + row*size + dy
                            ),
                            color
                        );
                        fsDrawPoint(&p, REND_MAX_ZINDEX);
                    }
                }
            }
        }
    }
}

void fsDrawString(FsVec2 position, int size, FsColor color, const char* string){
    int x = position.x;
    int y = position.y;

    for (int i = 0; string[i] != '\0'; i++) {
        char c = string[i];

        if (c == ' '){
            x += 8 * size;
            continue;
        };

        FsChar ch = fsMapChar(c);
        fsDrawChar(FsVec2_new(x, y), size, color, ch);

        x += 8 * size;
    }
}